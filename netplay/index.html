<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> NetPlay | Dominik Jeurissen </title> <meta name="author" content="Dominik Jeurissen"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://commandercero.github.io/netplay/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">figure{margin:0},.d-byline .byline{grid-template-columns:auto auto auto auto}</style> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "NetPlay",
            "description": "",
            "published": "April 04, 2024",
            "authors": [
              
              {
                "author": "Dominik Jeurissen",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Queen Mary University of London",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Diego Perez Liebana",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Queen Mary University of London",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Jeremy Gow",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Queen Mary University of London",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Duygu Cakmak",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Creative Assembly",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "James Kwan",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Creative Assembly",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Dominik</span> Jeurissen </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item dropdown active"> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">projects <span class="sr-only">(current)</span> </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item active" href="/netplay/">NetPlay</a> </div> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>NetPlay</h1> <p></p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#overview">Overview</a> </div> <div> <a href="#what-is-nethack">What is NetHack?</a> </div> <div> <a href="#netplay">NetPlay</a> </div> <div> <a href="#experiments-full-runs">Experiments - Full Runs</a> </div> <div> <a href="#experiments-scenarios">Experiments - Scenarios</a> </div> <div> <a href="#discussion">Discussion</a> </div> <div> <a href="#references">References</a> </div> </nav> </d-contents> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/dummy_600_400-480.webp 480w,/assets/img/dummy_600_400-800.webp 800w,/assets/img/dummy_600_400-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/dummy_600_400.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="overview">Overview</h2> <p>Recently, Large Language Models <b>(LLMs)</b> have shown great success as high-level planners for game-playing agents. However, many of these agents are primarily evaluated in simple environments with few objects or interactions<d-cite key="innermonologue"></d-cite><d-cite key="deps"></d-cite>, or in games such as Minecraft<d-cite key="gitm"></d-cite><d-cite key="voyager"></d-cite>, where long-term planning is relatively straightforward.</p> <p>We introduce NetPlay, the first LLM-powered zero-shot agent for the challenging roguelike NetHack<d-cite key="nethack"></d-cite>. Building upon existing approaches tailored for simpler dynamic environments such as Inner Monologue<d-cite key="innermonologue"></d-cite>, we extended its capabilities to address NetHack’s complexities. We evaluated the agent’s ability to play the full game and analyzed its behavior using various isolated scenarios.</p> <p>NetPlay excels in executing detailed instructions but struggles with more ambiguous tasks, such as winning the game. We discovered that NetPlay’s strength lies in its flexibility and creativity. Our experiments show that given enough context information, NetPlay can perform a wide range of tasks. Moreover, by focusing its attention on a particular problem, NetPlay is adept at exploring a wide range of potential solutions, but often with limited success due to a lack of explicit feedback guiding it.</p> <h2 id="what-is-nethack">What is NetHack?</h2> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/nethack_example-480.webp 480w,/assets/img/nethack_example-800.webp 800w,/assets/img/nethack_example-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/nethack_example.png" class="z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> A screenshot of NetHack's terminal view. Source <a href="https://alt.org/nethack" rel="external nofollow noopener" target="_blank">alt.org/nethack</a>. </div> <p>NetHack<d-cite key="nethack"></d-cite>, released in 1987, is an extremely challenging turn-based roguelike that continues to receive updates to this date. The objective is to traverse 50 procedurally generated levels, retrieving the Amulet of Yendor and successfully returning to the surface. Doing so unlocks the final challenge of the game: the four elemental planes, followed by the astral plane, where players must present the Amulet to their deity.</p> <p>NetHack encompasses a diverse array of monsters, items, and interactions. Players must skillfully utilize their resources while avoiding many of the game’s lethal threats. Even for seasoned players possessing extensive knowledge of the game, victory is far from guaranteed. The game’s inherent complexity requires players to continuously re-assess their situation to adapt to the unpredictability of the elements at play.</p> <p>The sheer size of NetHack, paired with the many sub-systems the player must understand, makes it an excellent candidate for evaluating the limitations of LLM agents. We used the NetHack Learning Environment<d-cite key="nle"></d-cite> <b>(NLE)</b> to play NetHack.</p> <h2 id="netplay">NetPlay</h2> <div class="l-body"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/nethack_agent.drawio-480.webp 480w,/assets/img/nethack_agent.drawio-800.webp 800w,/assets/img/nethack_agent.drawio-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/nethack_agent.drawio.png" class="z-depth-1" width="100%" height="auto" data-zoomable="" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="caption"> This is an illustration of how NetPlay plays NetHack. An LLM is prompted to select a skill from a given list using its memory, the current observation, and a task description containing available skills and the desired output format. The chosen skill is executed while a tracker enriches the given observations and detects important events, such as when a new monster appears. The prompting process is restarted when the chosen skill is finished or when an important event occurs to which the agent has to respond. </div> <p>Long-term planning in NetHack proves challenging due to its unpredictability, as we cannot know when, where, or what will appear as we explore. Consequently, our agent implements a closed-loop system where the LLM selects skills sequentially while accumulating feedback through game messages, errors, and manually detected events. Although we avoid constructing entire plans, the LLM’s thoughts are included for future prompts, allowing for strategic planning if deemed necessary by the LLM.</p> <h3 id="prompting">Prompting</h3> <p>We prompt the LLM to choose a skill from a predefined list. The prompt comprises three components: <b>(a)</b> the agent’s short-term memory, <b>(b)</b> a description of the observation, and <b>(c)</b> a task description alongside the output format.</p> <p><b>(a)</b> The observation description primarily focuses on the current level alongside additional data like context, inventory, and the agent’s stats. We attempt to convey spatial information by dividing the level into structures like rooms and corridors. Monsters are described separately from the structures by categorizing them as close or distant, indicating their potential threat level. The LLM is also informed about which structures can be further explored alongside the positions of boulders and doors that block exploration progress.</p> <p><b>(b)</b> The short-term memory is implemented using a list of messages representing the timeline of events. Each message is either categorized as system, AI, or human. System messages convey feedback from the environment, such as game messages or errors. AI messages are used for the LLM’s responses. Human messages indicate new tasks. Note that while it is possible for a human to provide continual feedback, we only study the case where the agent is given a task at the start of the game.</p> <p><b>(c)</b> The task description includes details about the current task, available skills, and a JSON output format. We employ chain-of-thought prompting<d-cite key="prompting"></d-cite> to guide the LLM to a skill choice.</p> <h3 id="skills">Skills</h3> <table> <thead> <tr> <th style="text-align: left">Name</th> <th style="text-align: left">Parameters</th> <th style="text-align: left">Description</th> </tr> </thead> <tbody> <tr> <td style="text-align: left">explore_level</td> <td style="text-align: left"> </td> <td style="text-align: left">Explores the level to find new rooms.</td> </tr> <tr> <td style="text-align: left">press_key</td> <td style="text-align: left">key: string</td> <td style="text-align: left">Presses the given letter.</td> </tr> <tr> <td style="text-align: left">pickup</td> <td style="text-align: left">x: int, y: int</td> <td style="text-align: left">Pickup things.</td> </tr> <tr> <td style="text-align: left">up</td> <td style="text-align: left">x: int, y: int</td> <td style="text-align: left">Go up a staircase.</td> </tr> <tr> <td style="text-align: left">drop</td> <td style="text-align: left">item_letter: string</td> <td style="text-align: left">Drop an item.</td> </tr> <tr> <td style="text-align: left">wield</td> <td style="text-align: left">item_letter: string</td> <td style="text-align: left">Wield a weapon.</td> </tr> <tr> <td style="text-align: left">kick</td> <td style="text-align: left">x: int, y: int</td> <td style="text-align: left">Kick something.</td> </tr> <tr> <td style="text-align: left">cast</td> <td style="text-align: left"> </td> <td style="text-align: left">Opens your spellbook to cast a spell.</td> </tr> <tr> <td style="text-align: left">pay</td> <td style="text-align: left"> </td> <td style="text-align: left">Pay your shopping bill.</td> </tr> </tbody> </table> <p>NetPlay uses handcrafted skills that implement different behaviors by returning a sequence of actions. They accept both mandatory and optional parameters as input. Skills can also generate messages as feedback, which are stored in the agent’s memory.</p> <p>Navigation is automated through skills like <b>move_to x y</b> or <b>go_to room_id</b>. However, exploring levels with only these skills proved challenging for the LLM. To address this, we automated exploration with the <ib>explore_level&lt;/b&gt; skill. This skill explores the current level by uncovering tiles, opening doors, and searching for hidden corridors.</ib></p> <p>To indicate when the agent is done with a given task, it has access to the <b>finish_task</b> skill. Additionally, the LLM is equipped with the <b>press_key</b> and <b>type_text</b> skills for navigating NetHack’s various game menus.</p> <p>The remaining skills are thin wrappers around NetHack commands, such as <i>drink</i> or <i>pickup</i>. However, these commands often involve multiple steps, such as confirming which item to drink or positioning the agent correctly to pick up an item. Consequently, the LLM often assumed that the <i>drink</i> command accepts an item parameter or that <i>pickup</i> works seamlessly regardless of the agent’s current position. To mitigate these issues, most command-skills automate some aspects to make the skills more intuitive for the LLM.</p> <h2 id="experiments---full-runs">Experiments - Full Runs</h2> <h2 id="experiments---scenarios">Experiments - Scenarios</h2> <p>After conducting the full runs, we hypothesized that although NetPlay can be creative and interact with most mechanics in the game, it tends to fixate on the most straightforward approach for a given task. To confirm this hypothesis, we tested NetPlay in various small-scale scenarios.</p> <div class="fake-img l-page"> <figure> <video src="/assets/video/instruction_clips.mp4" class="img-fluid rounded z-depth-1" width="auto" height="auto" controls=""></video> </figure> </div> <div class="caption"> <b>Instruction scenarios</b> tested the agent's ability to follow instructions. These scenarios show that NetPlay can easily follow detailed instructions. However, the <i>conditional</i> scenario highlights the agent's tendency to fixate too much on solving the instructions as quickly as possible without considering if there is something else it has to do first. </div> <div class="fake-img l-page"> <figure> <video src="/assets/video/game_mechanic_clips.mp4" class="img-fluid rounded z-depth-1" width="auto" height="auto" controls=""></video> </figure> </div> <div class="caption"> <b>Game mechanic scenarios</b> tested the agent's ability to interact with some mechanics in the game. Although the agent shows that it understands the mechanics, it often tends to get confused. These issues can be resolved by providing more detailed instructions. </div> <div class="fake-img l-page"> <figure> <video src="/assets/video/scenarios_clips.mp4" class="img-fluid rounded z-depth-1" width="auto" height="auto" controls=""></video> </figure> </div> <div class="caption"> <b>Creative scenarios</b> tested the agent's ability to solve a given problem. These scenarios highlight how NetPlay is often unreliable unless we provide detailed instructions. </div> <h2 id="discussion">Discussion</h2> <p>Our experiments show that despite the immense complexity of NetHack, the agent can fulfill a wide range of tasks given enough context information. To our knowledge, this is the first NetHack agent to exhibit such flexible behavior. However, the benefits of the presented approach diminish the more ambiguous a given task is, making tasks such as “Win the Game” impossible.</p> <p>A promising use case of the presented architecture is regression testing during game development. Game developers could test specific aspects of their game by providing NetPlay with detailed instructions on what to test. This approach could not only streamline the testing process but also benefit from NetPlay’s flexibility, enabling the tests to adapt dynamically as the game evolves.</p> <p>Given NetPlay’s proficiency when given detailed context information, an obvious extension to our approach would be granting the agent access to the NetHack Wikipedia. This could be done using a skill that accepts a query and adds the resulting information to the agent’s short-term memory. While this can improve the results at the cost of more LLM calls, finding the most relevant information for a given situation is tricky. Instead, we recommend investing future research into automated methods for finding relevant context information, with a particular focus on finding the most successful past interactions as guidelines on how to play.</p> <p>A significant limitation of our approach lies in the predefined skills and observation descriptions, which struggle to encompass NetHack’s vast complexity. Designing the agent to handle all potential edge cases proved challenging, as it is difficult to anticipate every scenario. While the premise of this approach is that the LLM can handle these edge cases, this is only true as long as we have a comprehensive description of the environment and flexible skills. In practice, achieving such a well-designed agent requires an ever-growing repertoire of skills and an observation description that grows infinitely. As such, another promising research direction is to use machine learning to replace the handcrafted components of the agent.</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/netplay.bib"></d-bibliography> </div> <footer class="sticky-bottom mt-5" role="contentinfo"> <div class="container"> © Copyright 2024 Dominik Jeurissen. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>